[원본 링크:우아한 기술블로그 - 배차 정확도를 높이는 실거리 시스템 구축하기: OSRM, Kafka, 그리고 Redis](https://techblog.woowahan.com/22396/)

배민커넥트의 배차 시스템에서 직선거리 대신 실거리를 활용한 사례가 소개됐다. 기존 방식은 속도는 빠르지만 라이더 실제 동선과 차이가 크다는 문제가 있었다. 이를 해결하기 위해 OSRM 기반의 실거리 계산 시스템을 직접 구축했다.

배민커넥트는 배달 효율성을 높이기 위해 기존의 직선거리 기반 배차 대신, 실제 도로를 따라 계산한 **실거리(실제 경로 기반 거리)**를 적용하는 시스템을 만들었다. 직선거리는 단순하고 빠르지만, 실제 배달 동선과 차이가 커서 라이더의 작업량 예측이나 배차 정확도가 떨어지는 문제가 있었다. 특히 여러 주문을 동시에 처리하는 상황에서는 오차가 배가되며, 서비스 품질에도 직접적인 영향을 주었다.

이를 해결하기 위해 팀은 오픈소스 내비게이션 엔진 **OSRM(Open Source Routing Machine)**을 도입했다. 상용 API는 비용과 응답 지연 문제가 있었기 때문에 자체 운영이 필요했다. 여기에 Kafka 기반 이벤트 드리븐 구조를 도입해, 주문 생성·변경·취소와 같은 이벤트가 발생할 때마다 필요한 거리만 계산하도록 했다. 이렇게 하면 불필요한 연산을 줄이고, 서비스의 실시간성을 확보할 수 있었다.

거리 계산 결과는 Redis에 캐싱해 재사용할 수 있게 했다. 단순 JSON 저장은 성능 저하가 있었기 때문에 Hash 구조로 좌표쌍별 거리를 저장했고, Redis 클러스터링을 통해 지역 단위로 키를 분산시켜 읽기/쓰기 병목을 최소화했다. 또한 TTL 기반 만료 대신, 배달이 끝나거나 취소될 때 직접 데이터를 삭제하는 방식을 적용해 메모리 낭비를 막았다.

최종적으로 이 시스템은 분당 수십만 건에 달하는 거리 계산 요청을 안정적으로 처리하면서도, 배차 정확도를 크게 높이는 성과를 냈다. 단순한 거리 계산 문제처럼 보이지만, 글은 이를 어떻게 이벤트 처리, 캐시 전략, 분산 시스템 설계까지 연결해 해결했는지를 잘 보여준다. 실시간 서비스 아키텍처나 DevOps에 관심 있는 사람들에게 인사이트를 줄 만한 사례였다.